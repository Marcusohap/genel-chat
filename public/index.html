<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>GENEL CHAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Tam ekran için html ve body */
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      width: 100%;
      overflow-x: hidden; /* sağa sola kaydırmayı engelle */
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh; /* viewport yüksekliği */
      /* padding kaldırıldı */
    }

    .chat-container {
      background: #1e293b;
      width: 100vw; /* tam ekran genişliği */
      height: 100vh; /* tam ekran yüksekliği */
      border-radius: 0; /* köşeler düz */
      box-shadow: none; /* gölge kaldırıldı */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: fixed; /* sabit pozisyon, kaydırılsa bile */
      top: 0; left: 0;
      max-width: 100vw;
      max-height: 100vh;
    }

    .chat-header {
      background: #334155;
      padding: 12px 16px 8px 16px;
      text-align: center;
      font-weight: 600;
      font-size: 22px;
      border-bottom: 1px solid #475569;
      position: relative;
      user-select: none;
      flex-shrink: 0; /* sabit yükseklik */
    }

    .online-count {
      position: absolute;
      right: 16px;
      top: 12px;
      font-size: 14px;
      color: #94a3b8;
      font-weight: 400;
    }

    .messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      scroll-behavior: smooth;
    }

    .message {
      padding: 10px 14px;
      border-radius: 8px;
      max-width: 80%;
      word-wrap: break-word;
      font-size: 15px;
      line-height: 1.3;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      position: relative;
    }

    .message.self {
      background: #3b82f6;
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 2px;
    }

    .message.other {
      background: #475569;
      align-self: flex-start;
      border-bottom-left-radius: 2px;
    }

    .reply-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 14px;
      height: 14px;
      background: #ef4444;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #1e293b;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 10px;
      font-weight: 700;
      user-select: none;
      transition: background 0.3s;
    }

    .reply-indicator:hover {
      background: #b91c1c;
    }

    .reply-preview {
      font-size: 13px;
      color: #cbd5e1;
      font-style: italic;
      margin-bottom: 4px;
      padding-left: 8px;
      border-left: 3px solid #64748b;
      max-width: 80%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: default;
    }

    .reply-preview.self {
      border-left-color: #2563eb;
    }

    .chat-form {
      display: flex;
      border-top: 1px solid #475569;
      padding: 8px 12px;
      background: #334155;
      align-items: center;
      gap: 8px;
      flex-shrink: 0; /* sabit yükseklik */
    }

    .chat-form input {
      flex: 1;
      padding: 12px;
      border: none;
      outline: none;
      font-size: 15px;
      background: #1e293b;
      color: white;
      border-radius: 6px;
      transition: background 0.3s ease;
    }

    .chat-form input:focus {
      background: #28343f;
    }

    .chat-form button, .chat-form .cancel-reply {
      padding: 12px 16px;
      background: #3b82f6;
      border: none;
      color: white;
      font-weight: 600;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.3s ease;
      user-select: none;
    }

    .chat-form button:hover, .chat-form .cancel-reply:hover {
      background: #2563eb;
    }

    .chat-form .cancel-reply {
      background: #ef4444;
    }

    .chat-form .cancel-reply:hover {
      background: #b91c1c;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: #334155;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      GENEL CHAT
      <span class="online-count" id="onlineCount">Çevrimiçi: 0</span>
    </div>
    <div class="messages" id="messages"></div>
    <form class="chat-form" id="form">
      <input
        id="input"
        autocomplete="off"
        maxlength="60"
        placeholder="Mesaj yaz (max 60 karakter)..."
      />
      <button type="submit">Gönder</button>
      <button type="button" class="cancel-reply" title="Yanıtlamayı iptal et" style="display:none;">İptal</button>
    </form>
  </div>

  <script>
    // Mevcut js kodun burada kalabilir, değişiklik gerek yok
    const socket = io(); // Sunucu adresini gerektiği gibi değiştir

    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messagesContainer = document.getElementById('messages');
    const onlineCountElem = document.getElementById('onlineCount');
    const cancelReplyBtn = form.querySelector('.cancel-reply');

    const userId = Math.random().toString(36).substring(2, 10);

    const bannedWords = [
  "amk", "ananı", "ananı sikiyim", "aq", "piç", "orospu", "siktir", "göt",
  "yarak", "kahpe", "ibne", "sürtük", "mal", "gerizekalı", "şerefsiz",
  "dangalak", "bok", "daşşak", "kaşar", "kaltak", "gavur", "ebenin amı",
  "amcık", "yarak kafalı", "pezevenk", "salak", "aptal", "puşt", "gavat",
  "pezevenk", "amına koyayım", "yavşak", "sikik", "piç kurusu", "domuz",
  "orospu çocuğu", "am", "amına", "amcık çocuğu", "kıç", "sikiş", "sikik piç",
  "şapşal", "gerzek", "bela", "oç", "ibnelik", "ananın amı", "ananın amk",
  "yarak", "amcık", "sikmek", "sikerim", "amcıklar", "yarrak", "amcık oğlu",
  "puşt", "götveren", "ebeni sikeyim", "ananı sikeyim", "pezevenk", "amına",
  "ebenin oğlu", "piç kurusu", "amına koyayım", "amı", "siktiğimin",
  "yarak kafalı", "yarak", "salak", "aptal", "boktan", "şerefsiz", "mal",
  "gerizekalı", "götveren", "döl", "amcık", "kaşar", "kaltak", "gavat",
  "sürtük", "amcık çocuğu", "amına koyayım", "ananı sikeyim", "amk", "bok",
  "piç", "sik", "ananın amı", "ananın amk", "siktir git", "göt", "yarak",
  "amcık", "kaltak", "kahpe", "şerefsiz", "sürtük", "dangalak", "aptal",
  "gerzek", "salak", "mal", "amına koyayım", "yavşak", "amcık oğlu", "amına",
  "yarrak", "piç kurusu", "ebeni sikeyim", "ananı sikeyim", "bok", "götveren",
  "amcık", "yarak", "mal", "aptal", "şapşal", "dangalak", "gerizekalı", "mal",
  "bok", "yarak kafalı", "amına koyayım", "puşt", "gavat", "pezevenk",
  "piç", "orospu çocuğu", "sikik", "amcık", "amına", "amına koyayım",
  "amcık oğlu", "yavşak", "götveren", "sürtük", "kaltak", "kaşar",
  "kahpe", "şerefsiz", "mal", "gerizekalı", "dangalak", "aptal", "salak",
  "boktan", "yarak", "amcık", "piç kurusu", "amına koyayım", "ebeni sikeyim",
  "ananı sikeyim", "amk", "bok", "piç", "sik", "ananın amı", "ananın amk",
  "siktir git", "göt", "yarak", "amcık", "kaltak", "kahpe", "şerefsiz",
  "sürtük", "dangalak", "aptal", "gerzek", "salak", "mal", "amına koyayım",
  "yavşak", "amcık oğlu", "amına", "yarrak", "piç kurusu", "ebeni sikeyim",
  "ananı sikeyim", "bok", "götveren", "amcık", "yarak", "mal", "aptal",
  "şapşal", "dangalak", "gerizekalı", "mal", "bok", "yarak kafalı",
  "amına koyayım", "puşt", "gavat", "pezevenk", "piç", "orospu çocuğu",
  "sikik", "amcık", "amına", "amına koyayım", "amcık oğlu", "yavşak",
  "götveren", "sürtük", "kaltak", "kaşar", "kahpe", "şerefsiz", "mal",
  "gerizekalı", "dangalak", "aptal", "salak", "boktan", "yarak", "amcık",
  "piç kurusu", "amına koyayım", "ebeni sikeyim", "ananı sikeyim", "porno", 
  "çocuk pornosu", "cocuk prno", "cocukprno", "cqcuk p0rno", "@", "t.me", "escort", "eskort", "siktim", "@m", "ag",
];


    let replyingToId = null;
    let messages = [];

    socket.on('all_messages', (msgs) => {
      messages = msgs;
      renderMessages();
      scrollToBottom();
    });

    socket.on('new_message', (msg) => {
      messages.push(msg);
      addMessage(msg);
      scrollToBottom();
    });

    socket.on('online_count', (count) => {
      onlineCountElem.textContent = `Çevrimiçi: ${count}`;
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      let text = input.value.trim();

      if (!text) return;

      if (text.length > 60) {
        alert('Maksimum 60 karakter yazabilirsin.');
        return;
      }

      const containsBadWord = bannedWords.some(word => {
  return text.toLowerCase().split(/\W+/).includes(word);
});


      if (containsBadWord) {
        alert('Lütfen küfürlü mesaj yazmayınız.');
        return;
      }

      const linkPattern = /(https?:\/\/|www\.)/i;
      if (linkPattern.test(text)) {
        alert('Reklam veremezsin. Reklam için t.me/kartalvip e yaz.');
        return;
      }

      const msg = {
        id: generateId(),
        text,
        userId,
        replyTo: replyingToId
      };

      socket.emit('send_message', msg);
      input.value = '';
      stopReplying();
    });

    cancelReplyBtn.addEventListener('click', () => {
      stopReplying();
    });

    function addMessage(msg) {
      messagesContainer.appendChild(createMessageElement(msg));
    }

    function renderMessages() {
      messagesContainer.innerHTML = '';
      messages.forEach(msg => {
        messagesContainer.appendChild(createMessageElement(msg));
      });
    }

    function createMessageElement(msg) {
      const div = document.createElement('div');
      div.classList.add('message');
      div.classList.add(msg.userId === userId ? 'self' : 'other');
      div.id = `msg-${msg.id}`;

      if (msg.replyTo) {
        const repliedMsg = messages.find(m => m.id === msg.replyTo);
        if (repliedMsg) {
          const replyPreview = document.createElement('div');
          replyPreview.classList.add('reply-preview');
          replyPreview.classList.add(repliedMsg.userId === userId ? 'self' : 'other');
          replyPreview.textContent = repliedMsg.text.length > 50 ? repliedMsg.text.slice(0, 50) + '…' : repliedMsg.text;
          div.appendChild(replyPreview);
        }
      }

      const textNode = document.createTextNode(msg.text);
      div.appendChild(textNode);

      if (messages.some(m => m.replyTo === msg.id && m.userId !== userId)) {
        const indicator = document.createElement('div');
        indicator.classList.add('reply-indicator');
        indicator.title = "Sana gelen yanıt var. Tıklayınca o mesaja gider.";
        indicator.textContent = "!";
        indicator.onclick = (e) => {
          e.stopPropagation();
          const targetMsg = document.getElementById(`msg-${msg.id}`);
          if (targetMsg) {
            targetMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
            targetMsg.style.backgroundColor = '#ef4444';
            setTimeout(() => {
              targetMsg.style.backgroundColor = '';
            }, 1200);
          }
        };
        div.appendChild(indicator);
      }

      div.style.cursor = 'pointer';
      div.title = "Mesaja tıklayarak yanıtla";
      div.onclick = () => {
        startReplying(msg.id, msg.text);
      };

      return div;
    }

    function startReplying(id, text) {
      replyingToId = id;
      input.placeholder = `Yanıt: ${text.length > 40 ? text.slice(0, 40) + '…' : text}`;
      cancelReplyBtn.style.display = 'inline-block';
      input.focus();
    }

    function stopReplying() {
      replyingToId = null;
      input.placeholder = 'Mesaj yaz (max 60 karakter)...';
      cancelReplyBtn.style.display = 'none';
    }

    function scrollToBottom() {
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function generateId() {
      return Math.random().toString(36).substr(2, 9);
    }
  </script>
</body>
</html>
